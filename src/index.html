<!DOCTYPE html>
<html lang="en" x-cloak>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Management System</title>
    <script
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
      defer
    ></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/@heroicons/v2/24/outline"
      rel="stylesheet"
    />
  </head>
  <body class="bg-gray-50">
    <div x-data="userManager()" x-init="fetchUsers()" class="min-h-screen p-8">
      <!-- Loading Overlay -->
      <div
        x-show="loading"
        class="fixed inset-0 bg-black/50 flex items-center justify-center z-50"
      >
        <div
          class="bg-white p-6 rounded-lg shadow-lg flex items-center space-x-2"
        >
          <svg
            class="animate-spin h-6 w-6 text-blue-500"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          <span class="text-gray-700">Loading...</span>
        </div>
      </div>

      <!-- Main Container -->
      <div class="max-w-7xl mx-auto space-y-8">
        <!-- Header -->
        <div
          class="flex justify-between items-center bg-white p-6 rounded-xl shadow-sm"
        >
          <div>
            <h1 class="text-2xl font-bold text-gray-900">
              User Management System
            </h1>
            <p class="text-gray-500 mt-1">
              Total Users: <span x-text="users.length"></span>
            </p>
          </div>
          <button
            @click="showUserForm = true; mode='create'"
            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center"
          >
            <svg
              class="w-5 h-5 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 4v16m8-8H4"
              />
            </svg>
            Add User
          </button>
        </div>

        <!-- User Form Modal -->
        <div
          x-show="showUserForm"
          class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"
          x-transition:enter="transition ease-out duration-300"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
        >
          <div
            class="bg-white rounded-2xl p-8 w-full max-w-2xl shadow-xl"
            @click.away="showUserForm = false"
          >
            <div class="flex justify-between items-center mb-6">
              <h3
                class="text-xl font-semibold"
                x-text="mode === 'create' ? 'Add New User' : 'Edit User'"
              ></h3>
              <button
                @click="showUserForm = false; clearForm()"
                class="text-gray-400 hover:text-gray-600"
              >
                <svg
                  class="w-6 h-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>

            <form
              @submit.prevent="mode === 'create' ? createUser() : updateUser()"
              class="space-y-6"
            >
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Personal Info -->
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >First Name</label
                    >
                    <input
                      type="text"
                      x-model="form.firstName"
                      required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Last Name</label
                    >
                    <input
                      type="text"
                      x-model="form.lastName"
                      required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Age</label
                    >
                    <input
                      type="number"
                      x-model="form.age"
                      min="18"
                      max="100"
                      required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Gender</label
                    >
                    <select
                      x-model="form.gender"
                      required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                </div>

                <!-- Contact Info -->
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Email</label
                    >
                    <input
                      type="email"
                      x-model="form.email"
                      required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Phone Number</label
                    >
                    <input
                      type="tel"
                      x-model="form.phoneNumber"
                      required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Country</label
                    >
                    <input
                      type="text"
                      x-model="form.country"
                      required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >City</label
                    >
                    <input
                      type="text"
                      x-model="form.city"
                      required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >Occupation</label
                >
                <input
                  type="text"
                  x-model="form.work"
                  required
                  class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                />
              </div>

              <div class="flex justify-end space-x-3">
                <button
                  type="button"
                  @click="showUserForm = false; clearForm()"
                  class="px-4 py-2 border rounded-lg hover:bg-gray-50"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  :disabled="loading"
                  class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400"
                >
                  <span
                    x-text="mode === 'create' ? 'Create User' : 'Update User'"
                  ></span>
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Users Table -->
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div
            class="px-6 py-4 border-b flex items-center justify-between bg-gray-50"
          >
            <div class="flex items-center space-x-4">
              <h4 class="font-medium text-gray-900">User Directory</h4>
              <div class="flex items-center space-x-2">
                <button
                  @click="showActive = true"
                  :class="showActive ? 'bg-blue-100 text-blue-600' : 'text-gray-500'"
                  class="px-3 py-1 rounded-md text-sm"
                >
                  Active (<span x-text="activeUsersCount"></span>)
                </button>
                <button
                  @click="showActive = false"
                  :class="!showActive ? 'bg-blue-100 text-blue-600' : 'text-gray-500'"
                  class="px-3 py-1 rounded-md text-sm"
                >
                  Deleted (<span x-text="deletedUsersCount"></span>)
                </button>
              </div>
            </div>
            <div class="relative">
              <input
                type="text"
                x-model="searchQuery"
                placeholder="Search users..."
                class="w-64 px-4 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500"
              />
            </div>
          </div>

          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                  >
                    Name
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                  >
                    Contact
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                  >
                    Location
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                  >
                    Details
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                  >
                    Status
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                  >
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                <template x-for="user in filteredUsers" :key="user.uid">
                  <tr>
                    <td class="px-6 py-4">
                      <div class="flex items-center">
                        <div class="ml-4">
                          <div
                            class="font-medium text-gray-900"
                            x-text="`${user.firstName} ${user.lastName}`"
                          ></div>
                          <div
                            class="text-sm text-gray-500"
                            x-text="user.gender"
                          ></div>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <div
                        class="text-sm text-gray-900"
                        x-text="user.email"
                      ></div>
                      <div
                        class="text-sm text-gray-500"
                        x-text="user.phoneNumber"
                      ></div>
                    </td>
                    <td class="px-6 py-4">
                      <div
                        class="text-sm text-gray-900"
                        x-text="user.country"
                      ></div>
                      <div
                        class="text-sm text-gray-500"
                        x-text="user.city"
                      ></div>
                    </td>
                    <td class="px-6 py-4">
                      <div class="text-sm">
                        <span class="text-gray-900" x-text="user.age"></span>
                        years
                        <span class="mx-1">Â·</span>
                        <span class="text-gray-900" x-text="user.work"></span>
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <span
                        x-text="user.isDeleted ? 'Deleted' : 'Active'"
                        :class="user.isDeleted ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'"
                        class="px-2 py-1 rounded-full text-xs font-medium"
                      ></span>
                    </td>
                    <td class="px-6 py-4 space-x-2">
                      <button
                        @click="editUser(user)"
                        class="text-blue-600 hover:text-blue-900"
                      >
                        <svg
                          class="w-5 h-5"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"
                          />
                        </svg>
                      </button>
                      <button
                        @click="toggleDeleteStatus(user.uid)"
                        class="text-yellow-600 hover:text-yellow-900"
                      >
                        <svg
                          class="w-5 h-5"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                          />
                        </svg>
                      </button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("alpine:init", () => {
        Alpine.data("userManager", () => ({
          // State
          users: [],
          showUserForm: false,
          mode: "create",
          loading: false,
          error: null,
          showActive: true,
          searchQuery: "",

          form: {
            uid: "",
            firstName: "",
            lastName: "",
            age: 25,
            gender: "Male",
            country: "",
            city: "",
            phoneNumber: "",
            email: "",
            work: "",
            isDeleted: false,
          },

          // Computed
          get activeUsersCount() {
            return this.users.filter((u) => !u.isDeleted).length;
          },
          get deletedUsersCount() {
            return this.users.filter((u) => u.isDeleted).length;
          },
          get filteredUsers() {
            return this.users.filter(
              (u) =>
                (this.showActive ? !u.isDeleted : u.isDeleted) &&
                Object.values(u).some((value) =>
                  String(value)
                    .toLowerCase()
                    .includes(this.searchQuery.toLowerCase())
                )
            );
          },

          // Methods
          async fetchUsers() {
            try {
              this.loading = true;
              const response = await fetch(
                "https://crudemate-server.vercel.app/api/v1/get-all-users"
              );
              if (!response.ok) throw new Error("Failed to fetch users");
              this.users = await response.json();
            } catch (error) {
              this.error = error.message;
            } finally {
              this.loading = false;
            }
          },

          async createUser() {
            try {
              this.loading = true;
              const response = await fetch(
                "https://crudemate-server.vercel.app/api/v1/create-user",
                {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(this.form),
                }
              );
              if (!response.ok) throw new Error("Failed to create user");
              await this.fetchUsers();
              this.showUserForm = false;
              this.clearForm();
            } catch (error) {
              this.error = error.message;
            } finally {
              this.loading = false;
            }
          },

          async updateUser() {
            try {
              this.loading = true;
              const response = await fetch(
                `https://crudemate-server.vercel.app/api/v1/update-user/${this.form.uid}`,
                {
                  method: "PUT",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(this.form),
                }
              );
              if (!response.ok) throw new Error("Failed to update user");
              await this.fetchUsers();
              this.showUserForm = false;
              this.clearForm();
            } catch (error) {
              this.error = error.message;
            } finally {
              this.loading = false;
            }
          },

          async toggleDeleteStatus(uid) {
            try {
              this.loading = true;
              const response = await fetch(
                `https://crudemate-server.vercel.app/api/v1/user/${uid}/toggle-delete`,
                {
                  method: "PATCH",
                }
              );
              if (!response.ok) throw new Error("Failed to toggle status");
              await this.fetchUsers();
            } catch (error) {
              this.error = error.message;
            } finally {
              this.loading = false;
            }
          },

          editUser(user) {
            this.form = { ...user };
            this.mode = "edit";
            this.showUserForm = true;
          },

          clearForm() {
            this.form = {
              uid: "",
              firstName: "",
              lastName: "",
              age: 25,
              gender: "Male",
              country: "",
              city: "",
              phoneNumber: "",
              email: "",
              work: "",
              isDeleted: false,
            };
            this.mode = "create";
          },
        }));
      });
    </script>
  </body>
</html>
